#!/bin/bash
# Check System Uptime Plugin
# Monitors system uptime

# Get uptime in seconds
UPTIME_SECONDS=$(cat /proc/uptime | awk '{print int($1)}')

# Convert to human readable format
DAYS=$((UPTIME_SECONDS / 86400))
HOURS=$(((UPTIME_SECONDS % 86400) / 3600))
MINUTES=$(((UPTIME_SECONDS % 3600) / 60))

# Format output
if [ $DAYS -gt 0 ]; then
    UPTIME_STR="${DAYS}d ${HOURS}h ${MINUTES}m"
else
    UPTIME_STR="${HOURS}h ${MINUTES}m"
fi

# Check minimum uptime threshold (warn if less than 5 minutes = freshly rebooted)
WARN_THRESHOLD=300

if [ $UPTIME_SECONDS -lt $WARN_THRESHOLD ]; then
    echo "WARNING: System just rebooted. Uptime: $UPTIME_STR (${UPTIME_SECONDS}s) | uptime=${UPTIME_SECONDS}s"
    exit 1
fi

# All OK
echo "OK: System uptime: $UPTIME_STR (${UPTIME_SECONDS}s) | uptime=${UPTIME_SECONDS}s"
exit 0
